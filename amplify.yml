version: 1.0
frontend:
  phases:
    preBuild:
      commands:
        - hugo version
    build:
      commands:
        - echo Building docs with Hugo
        - echo Now move static images and files ...
        - aws s3 sync static $STATIC_BUCKET --delete
        - echo Remove static directory
        - rm -rf static
        - echo Building docs ...
        - hugo --baseURL $BASEURL
        - echo Successfully built docs
        - du -h -d 1 public
        - find public -name '*.html' -type f -exec sed -i "s,docs-cdn.cumulusnetworks.com,$STATIC_DOMAIN,g" {} +
        - find public -name '*.xml' -type f -exec sed -i "s,docs-cdn.cumulusnetworks.com,$STATIC_DOMAIN,g" {} +
  artifacts:
    files:
      - '**/*'
    baseDirectory: public
  cache:
    paths: []
